<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <title>Mail type - Agent Immobilier</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, sans-serif;
      background: #0d1b2a;
      color: #f4f4f4;
      margin: 0;
      padding: 20px;
    }
    header {
      background: #14243a;
      padding: 15px 20px;
      color: #fff;
      text-align: center;
      box-shadow: 0 4px 12px rgba(0,0,0,0.4);
      margin-bottom: 25px;
      border-radius: 8px;
    }
    h1 {
      font-size: 24px;
      margin: 0;
    }
    section {
      background: #1b263b;
      padding: 20px;
      margin-bottom: 25px;
      border-radius: 10px;
      box-shadow: 0 6px 14px rgba(0,0,0,0.5);
    }
    label {
      display: block;
      margin: 10px 0 5px;
      font-weight: 600;
      color: #ffb347;
    }
    select, input[type="date"], input[type="text"], textarea {
      width: 100%;
      max-width: 600px;
      padding: 10px;
      border: none;
      border-radius: 8px;
      outline: none;
      font-size: 14px;
      background: #0d1b2a;
      color: #f4f4f4;
      box-shadow: inset 0 2px 5px rgba(0,0,0,0.4);
    }
    textarea { min-height: 70px; resize: vertical; }
    .button {
      margin-top: 12px;
      background: linear-gradient(135deg, #ff7a00, #e65c00);
      color: #fff;
      border: none;
      padding: 12px 25px;
      border-radius: 8px;
      cursor: pointer;
      font-weight: bold;
      font-size: 14px;
      letter-spacing: 0.5px;
      box-shadow: 0 5px 10px rgba(0,0,0,0.4);
    }
    .button:hover { background: #ff9633; transform: translateY(-2px); }
    .row { display: flex; gap: 20px; flex-wrap: wrap; }
    .btn-retour {
      display: inline-block;
      margin-bottom: 20px;
      background: #16375e;
      color: #fff;
      padding: 10px 20px;
      border-radius: 8px;
      text-decoration: none;
      font-weight: bold;
      box-shadow: 0 3px 8px rgba(0,0,0,0.4);
    }
    .btn-retour:hover {
      background: #1d4e85;
    }
  </style>
</head>
<body>
  <header>
    <h1>üìß G√©n√©rateur de mails - Agent Immobilier</h1>
  </header>

  <!-- Bouton retour -->
  <a href="/#Feuille" class="btn-retour">‚¨Ö Retour √† la feuille</a>

  <!-- Formulaire -->
  <section>
    <label>üë§ Nom du client :</label>
    <input type="text" id="client" />

    <label>üè† Adresse du bien :</label>
    <input type="text" id="adresse" />

    <div class="row">
      <div>
        <label>√âtape :</label>
        <select id="typeMail">
          <option>R0 - Contact</option>
          <option>R1 - Visite d√©couverte</option>
          <option>R2 - Estimation & Mandat</option>
          <option>Commercialisation</option>
          <option>Qualification acqu√©reur</option>
          <option>Visites organis√©es</option>
          <option>Offre re√ßue</option>
          <option>Compromis sign√©</option>
          <option>Acte authentique</option>
        </select>
      </div>
      <div>
        <label>Date :</label>
        <input type="date" id="date" />
      </div>
      <div>
        <label>Heure :</label>
        <select id="heure">
          <option>10h</option><option>12h</option><option>14h</option>
          <option>15h30</option><option>16h</option><option>18h</option>
        </select>
      </div>
    </div>

    <button class="button" onclick="genererMail()">üìß G√©n√©rer le mail</button>
  </section>

  <!-- R√©sultat -->
  <section>
    <h2>Objet :</h2>
    <textarea id="objet" readonly></textarea>
    <h2>Corps :</h2>
    <textarea id="corps" readonly></textarea>

    <button class="button" onclick="ouvrirOutlook()">üì§ Ouvrir dans Outlook</button>
    <button class="button" onclick="exporterPDF()">üìÑ Exporter PDF</button>
  </section>

  <script>
   const modeles = {
  "R0 - Contact": {
    objet: "Prise de contact avec {CLIENT} ‚Äì {DATE}",
    corps: `Bonjour {CLIENT},

Suite √† votre demande concernant le bien situ√© au {ADRESSE}, je me permets de vous contacter afin d‚Äô√©changer sur votre projet immobilier. 

Je reste √† votre disposition pour convenir d‚Äôun premier rendez-vous t√©l√©phonique ou physique selon vos disponibilit√©s.

Bien cordialement,
[Votre Nom / Agence]`
  },
  "R1 - Visite d√©couverte": {
    objet: "Confirmation de la visite ‚Äì {ADRESSE} le {DATE}",
    corps: `Bonjour {CLIENT},

Comme convenu, la visite du bien situ√© au {ADRESSE} est programm√©e le {DATE} √† {HEURE}. 

Merci de bien vouloir me confirmer votre pr√©sence ou de me pr√©venir en cas d‚Äôemp√™chement.

Dans l‚Äôattente de notre rencontre, je reste √† votre disposition.

Bien √† vous,
[Votre Nom / Agence]`
  },
  "R2 - Estimation & Mandat": {
    objet: "Estimation du bien et proposition de mandat ‚Äì {ADRESSE}",
    corps: `Bonjour {CLIENT},

Veuillez trouver ci-joint l‚Äôestimation r√©alis√©e pour le bien situ√© au {ADRESSE}. 

Nous pourrons √©changer ensemble sur cette √©valuation et, si vous le souhaitez, formaliser un mandat de vente afin de mettre votre bien sur le march√© dans les meilleures conditions.

Je reste √† votre disposition pour toute question.

Bien cordialement,
[Votre Nom / Agence]`
  },
  "Commercialisation": {
    objet: "Mise en commercialisation ‚Äì {ADRESSE}",
    corps: `Bonjour {CLIENT},

Votre bien situ√© au {ADRESSE} est d√©sormais en ligne et visible sur nos plateformes partenaires. 

Nous ne manquerons pas de vous informer r√©guli√®rement des retours des acqu√©reurs potentiels ainsi que des visites planifi√©es.

Merci pour votre confiance.

Bien cordialement,
[Votre Nom / Agence]`
  },
  "Qualification acqu√©reur": {
    objet: "Qualification d‚Äôun acqu√©reur potentiel ‚Äì {ADRESSE}",
    corps: `Bonjour {CLIENT},

Un acqu√©reur int√©ress√© par votre bien situ√© au {ADRESSE} a √©t√© identifi√©. 

Nous allons organiser un entretien afin de qualifier son projet et de v√©rifier sa capacit√© de financement avant toute proposition d‚Äôachat.

Je ne manquerai pas de revenir vers vous avec davantage de d√©tails.

Bien √† vous,
[Votre Nom / Agence]`
  },
  "Visites organis√©es": {
    objet: "Organisation des visites ‚Äì {ADRESSE} le {DATE}",
    corps: `Bonjour {CLIENT},

Les visites du bien situ√© au {ADRESSE} sont pr√©vues le {DATE} √† partir de {HEURE}. 

Nous mettrons tout en ≈ìuvre pour valoriser votre bien et recueillir des retours constructifs des acqu√©reurs potentiels.

Je vous ferai un compte rendu d√©taill√© √† l‚Äôissue des visites.

Bien cordialement,
[Votre Nom / Agence]`
  },
  "Offre re√ßue": {
    objet: "R√©ception d‚Äôune offre d‚Äôachat ‚Äì {ADRESSE}",
    corps: `Bonjour {CLIENT},

Nous avons le plaisir de vous informer qu‚Äôune offre d‚Äôachat a √©t√© re√ßue pour votre bien situ√© au {ADRESSE}. 

Nous reviendrons rapidement vers vous pour en discuter ensemble et analyser les conditions propos√©es.

Bien √† vous,
[Votre Nom / Agence]`
  },
  "Compromis sign√©": {
    objet: "Signature du compromis ‚Äì {ADRESSE}",
    corps: `Bonjour {CLIENT},

Le compromis de vente concernant votre bien situ√© au {ADRESSE} a √©t√© sign√© le {DATE}. 

Nous allons d√©sormais pr√©parer les prochaines √©tapes administratives en vue de l‚Äôacte authentique.

Je reste disponible pour toute question.

Bien cordialement,
[Votre Nom / Agence]`
  },
  "Acte authentique": {
    objet: "Signature de l‚Äôacte authentique ‚Äì {ADRESSE}",
    corps: `Bonjour {CLIENT},

Nous vous confirmons que la signature de l‚Äôacte authentique pour le bien situ√© au {ADRESSE} est pr√©vue le {DATE} √† {HEURE}. 

Toutes nos f√©licitations pour la concr√©tisation de cette vente. 

Merci pour votre confiance tout au long de ce projet.

Bien √† vous,
[Votre Nom / Agence]`
  }
};


    function getFormattedDate(date) {
      if (!date) return "JJ/MM/AAAA";
      const d = new Date(date);
      return isNaN(d) ? "JJ/MM/AAAA" : d.toLocaleDateString('fr-FR');
    }
    function genererMail() {
      const type = document.getElementById("typeMail").value;
      const client = document.getElementById("client").value;
      const adresse = document.getElementById("adresse").value;
      const date = document.getElementById("date").value;
      const heure = document.getElementById("heure").value;
      const dateStr = getFormattedDate(date);

      let objetTpl = modeles[type]?.objet || "{TYPE} ‚Äì {ADRESSE}";
      let corpsTpl = modeles[type]?.corps || "Message auto";

      const replacements = {
        "{CLIENT}": client,
        "{ADRESSE}": adresse,
        "{DATE}": dateStr,
        "{HEURE}": heure,
        "{TYPE}": type
      };

      for (const token in replacements) {
        objetTpl = objetTpl.replaceAll(token, replacements[token]);
        corpsTpl = corpsTpl.replaceAll(token, replacements[token]);
      }

      document.getElementById("objet").value = objetTpl.trim();
      document.getElementById("corps").value = corpsTpl.trim();
    }

    function ouvrirOutlook() {
      const subject = document.getElementById("objet").value.trim();
      let bodyText = document.getElementById("corps").value.trim();
      bodyText = bodyText.replace(/\n/g, '\r\n');
      const mailto = `mailto:?subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(bodyText)}`;
      window.location.href = mailto;
    }

    function exporterPDF() {
      const { jsPDF } = window.jspdf;
      const doc = new jsPDF();
      const objet = document.getElementById("objet").value.trim();
      const corps = document.getElementById("corps").value.trim();
      doc.setFont("helvetica","bold"); doc.text("Objet :", 10, 20);
      doc.setFont("helvetica","normal"); doc.text(objet, 30, 20);
      doc.setFont("helvetica","bold"); doc.text("Corps :", 10, 40);
      doc.setFont("helvetica","normal");
      const lignes = doc.splitTextToSize(corps, 180);
      doc.text(lignes, 10, 50);
      doc.save("mail_immobilier.pdf");
    }

    function preRemplirDepuisFiche() {
      const params = new URLSearchParams(window.location.search);
      if (params.get("client")) document.getElementById("client").value = params.get("client");
      if (params.get("adresse")) document.getElementById("adresse").value = params.get("adresse");
    }

    window.onload = preRemplirDepuisFiche;
  </script>
</body>
</html>
